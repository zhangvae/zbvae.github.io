<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> · zbvae's blog</title><meta name="description" content=" - Bin Zhang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><!-- fonts--><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://fonts.lug.ustc.edu.cn/css?family=Source+Sans+Pro:400,600" type="text/css"><!-- baidu analytics--><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?9e0cbea7d3319c6c94c71dfb93c151b8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><!-- google analytics--><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-74273646-1', 'auto');
ga('send', 'pageview');</script></head><body><input type="checkbox" id="sidebar-toggle"><aside><div class="author"><a href="/."><img src="/img/author.png" class="author-img"></a><h2 class="author-name">Bin Zhang</h2></div><div class="post-toc"><span class="toc-title">Directory</span><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Echarts简介"><span class="toc-text">Echarts简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Echarts使用"><span class="toc-text">Echarts使用</span></a></li></ol></div></aside><div class="main"><header><div id="top"><a href="/." class="logo-link">zbvae's blog</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">Tags</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li></ul></div></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title"></h1><div class="post-time">Apr 10, 2016</div><div class="post-content"><p>title: 使用Echarts制作散点图(Excel 导入数据方式)<br>date: 2015-07-11 10:34:53<br>tags: [技术交流]</p>
<hr>
<p><strong>摘要</strong>：Echarts是一款有效的js制图工具很多时候，其主要优势在于网页浏览时，具有非常炫酷的效果，但是将其保存为静态图像也很美观。我们在写工作报告或写论文的时候，都需要制作基本的统计图表以直观展示结果数据，虽然Excel提供的图表制作工具能满足要求，但美观度欠佳，也许可以调整，但还是需要很大的工作量，今天给大家介绍一款非常实用的且有效的制图工具，相信，您亲自使用之后就知道它有多妙了！<a id="more"></a></p>
<h3 id="Echarts简介">Echarts简介</h3><p>Echarts相当于一款JS插件，可以制作出绚丽多彩的图表，其支持制作的图表类型和可以使用的样式都非常丰富。</p>
<p>本文以Echarts制作散点图为例，向大家展示该工具的实用性。</p>
<h3 id="Echarts使用">Echarts使用</h3><p>Echarts的使用门槛非常简单，但使用条件必须符合规则，在<a href="http://echarts.baidu.com/" target="_blank" rel="external">官网</a>上下载开发包之后，自己准备一个项目主文件夹，在该文件夹新建一个js文件夹（名称自选），将开发包下的build文件夹下的dist文件夹拷贝到js文件夹下，便可以开始使用了。</p>
<p>Echarts的使用方式可以分为<strong>AMD模块化导入</strong>和<strong>单文件导入</strong>方式，本文介绍一种简单的单文件导入方式，首先准备好一个html文件，导入echarts.js文件即可。</p>
<p>当然你还需要准备一个div控件用于安放图表位置，也可以认为是要为Echarts实例化的Dom对象，这里JavaScript代码也放在body标签下。</p>
<pre><code><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>    
    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"GBK"</span>&gt;</span> 
    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Echarts of scatter<span class="tag">&lt;/<span class="title">title</span>&gt;</span>  
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="comment">&lt;!--为Echarts准备一个大小为600*400的div--&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"main"</span> <span class="attribute">style</span>=<span class="value">"width:600px;height:400px"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span> 
    <span class="comment">&lt;!--Echarts单文件导入--&gt;</span>     
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"./js/dist/echarts.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span> 
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
</code></pre><p>至此，Echarts文件已完成导入，在使用之前，还需要进行路径配置：</p>
<pre><code><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>    
    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"GBK"</span>&gt;</span> 
    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Echarts of scatter<span class="tag">&lt;/<span class="title">title</span>&gt;</span>  
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="comment">&lt;!--为Echarts准备一个大小为600*400的div--&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"main"</span> <span class="attribute">style</span>=<span class="value">"width:600px;height:400px"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span> 
    <span class="comment">&lt;!--Echarts单文件导入--&gt;</span>     
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"./js/dist/echarts.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span> 
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="less">
        <span class="comment">//配置路径</span>
        <span class="tag">require</span><span class="class">.config</span>({
            <span class="tag">paths</span>:{         
                 <span class="attribute">echarts</span>:<span class="string">'./js/dist'</span>
            }
        }) 
    </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span> 
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
</code></pre><p>路径配置好后，可以进行使用，首先需要指定要制作的图表，进行模块导入，可以根据需要导入多个图表模块：</p>
<pre><code><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="less">    
    <span class="comment">//配置路径 </span>
    <span class="tag">require</span><span class="class">.config</span>({
          <span class="tag">paths</span>:{
            <span class="attribute">echarts</span>:<span class="string">'./js/dist'</span>
          } 
    }) 
    <span class="comment">//使用     </span>
    <span class="tag">require</span>(
        [     
            <span class="string">'echarts'</span>,
            <span class="string">'echarts/chart/scatter'</span> 
        ] 
    )
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre><p>基于原先的div创建echarts，并使用，主要是图表option的配置:</p>
<pre><code><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="scala">
  <span class="comment">//配置路径</span>
  require.config({
       paths:{
        echarts:'./js/dist'
       }
  });

  <span class="comment">//使用</span>
  require(
       [
        <span class="symbol">'echart</span>s',
        <span class="symbol">'echarts</span>/chart/scatter'
       ],

   function(ec){
    <span class="comment">//基于准备好的DOM，初始化echarts图表</span>
    <span class="keyword">var</span> myChart = ec.init(document.getElementById(<span class="symbol">'mai</span>n'),<span class="symbol">'shin</span>e'); <span class="comment">//这里的shine可以改成其他样式，可以参照官网实例的样式表</span>
    <span class="keyword">var</span> option = {
         title:{
              <span class="comment">//可以指定图表标题</span>
         },
         renderAsImage : <span class="literal">true</span>,
        <span class="comment">//symbolList : ["emptyCircle"],</span>
         tooltip:{<span class="comment">//提示框的显示，主要具有web效果</span>
              show:<span class="literal">true</span>,
              trigger: <span class="symbol">'axi</span>s',
              showDelay : <span class="number">0</span>,
              axisPointer:{
                   show: <span class="literal">true</span>,
                   <span class="class"><span class="keyword">type</span> :</span> <span class="symbol">'cros</span>s',
                   lineStyle: {
                    <span class="class"><span class="keyword">type</span> :</span> <span class="symbol">'dashe</span>d',
                    width : <span class="number">1</span>
                   }
              }
         },

         xAxis:[
              {
                   name : <span class="symbol">'Wr</span>G',
                   <span class="class"><span class="keyword">type</span> :</span> <span class="symbol">'valu</span>e',
                   scale:<span class="literal">true</span>,
              }
         ],

         yAxis:[
              {
                   name: <span class="symbol">'C</span>u',
                   <span class="class"><span class="keyword">type</span> :</span> <span class="symbol">'valu</span>e',
                   scale:<span class="literal">true</span>,
              }
         ],

         series:[
              {
                   <span class="string">"name"</span>:<span class="string">"CuOre"</span>,
                   <span class="string">"type"</span>:<span class="string">"scatter"</span>,
                   <span class="string">"data"</span>:xyData,<span class="comment">//注意这里的xyData就是关键的散点图显示数据，是一个二维数组，即数组内部每一个元素都是xy值对</span>
                   <span class="string">"markPoint"</span> : {
                    <span class="comment">//标记点 </span>
                    data : [
                        {<span class="class"><span class="keyword">type</span>:</span><span class="symbol">'ma</span>x'},
                        {<span class="class"><span class="keyword">type</span>:</span><span class="symbol">'mi</span>n'} 
                    ]
                   },
                   <span class="string">"markLine"</span> : {
                    <span class="comment">//标记线自己定制 </span>
                }
              }
         ]
    };
    <span class="comment">//为ECharts对象加载数据</span>
    myChart.setOption(option);
       }
  );

 </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre><p>现在图表的各项已经配置完毕，关键就是xyData数据的充填，当然用户可以自行指定为：[[1,2],[2,2],[3,4],[4,5]],数据少的时候我们可以直接充填，但是数据条目一旦很多，人工输入就很难完成了，因此这里介绍一种从Excel导入数据,再利用js重新组装来进行xyData的充填。代码如下：</p>
<pre><code><span class="comment">&lt;!-- 以下是设置从Excel中加载数据--&gt;</span>
 <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">  
    <span class="function"><span class="keyword">function</span> <span class="title">importXLS</span>(<span class="params">field</span>)</span>{   
           <span class="keyword">var</span> fullpath = <span class="built_in">window</span>.document.location.pathname;
           <span class="keyword">var</span> pos1 = fullpath.indexOf(<span class="string">"/"</span>);
           <span class="keyword">var</span> fileName1 = fullpath.substring(pos1+<span class="number">1</span>);
           <span class="keyword">var</span> pos2 = fileName1.lastIndexOf(<span class="string">"/"</span>);

           <span class="keyword">var</span> fileName = fileName1.substring(<span class="number">0</span>,pos2) + <span class="string">"/scatter_data.xls"</span>;<span class="comment">// xls文件的路径  </span>
           objCon = <span class="keyword">new</span> ActiveXObject(<span class="string">"ADODB.Connection"</span>); 
           objCon.Provider = <span class="string">"Microsoft.Jet.OLEDB.4.0"</span>;  
           objCon.ConnectionString = <span class="string">"Data Source="</span> + fileName + <span class="string">";Extended Properties=Excel 8.0;"</span>;  
           objCon.CursorLocation = <span class="number">1</span>;  
           objCon.Open;  
           <span class="keyword">var</span> strQuery;  

        <span class="comment">//Get the SheetName  </span>
           <span class="keyword">var</span> strSheetName = <span class="string">"Sheet1$"</span>; <span class="comment">//要导入的sheet的名字  </span>

           <span class="keyword">var</span> rsTemp =   <span class="keyword">new</span> ActiveXObject(<span class="string">"ADODB.Recordset"</span>);  
           rsTemp = objCon.OpenSchema(<span class="number">20</span>);  
           <span class="keyword">if</span>(!rsTemp.EOF)strSheetName = rsTemp.Fields(<span class="string">"Table_Name"</span>).Value;  
           rsTemp = <span class="literal">null</span>;  

           rsExcel =   <span class="keyword">new</span> ActiveXObject(<span class="string">"ADODB.Recordset"</span>);  
           strQuery = <span class="string">"SELECT * FROM ["</span> + strSheetName + <span class="string">"]"</span>;  
           rsExcel.ActiveConnection = objCon;  
           rsExcel.Open(strQuery);  

           <span class="keyword">var</span> res = [];  
           <span class="keyword">var</span> temp;  
           <span class="keyword">while</span>(!rsExcel.EOF){  
            temp = rsExcel.Fields(field).value; 
            res.push(temp);       
            rsExcel.MoveNext;     
           }   

           <span class="comment">// Close the connection and dispose the file  </span>
           objCon.Close;  
           objCon =<span class="literal">null</span>;  
           rsExcel = <span class="literal">null</span>;  
           <span class="keyword">return</span> res;   
     }  
 </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre><p>导入的Excel数据是读取某个字段的一维数组数据，我们需要导入x,y两个字段的数据，并组装成xyData二维数组格式：</p>
<pre><code><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="function"><span class="keyword">function</span>(<span class="params">ec</span>)</span>{
        <span class="keyword">var</span> xData = importXLS(<span class="number">1</span>);
        <span class="keyword">var</span> yData = importXLS(<span class="number">2</span>);
        <span class="keyword">var</span> xyData = [];

        <span class="keyword">var</span> i;
        <span class="comment">//转化为散点图需要的二维数组系列</span>
        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;xData.length;i++){
         xyData.push(<span class="keyword">new</span> <span class="built_in">Array</span>(xData[i],yData[i]));
        }

        <span class="comment">//基于准备好的DOM，初始化echarts图表</span>
        <span class="keyword">var</span> myChart = ec.init(<span class="built_in">document</span>.getElementById(<span class="string">'main'</span>),<span class="string">'shine'</span>);
        ... <span class="comment">//接着上面的使用Echarts的代码</span>
    }
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre><p>这样便实现了从Excel中导入数据，重新组装，充填为散点图所需要的二维数组格式。</p>
<p>给一个本程序生成的静态图片如下：</p>
<center><img src="/images/scatter1.png" alt="散点图，样式为infographic"><img src="/images/scatter2.png" alt="散点图，样式为shine"></center></div></article></div><div class="tags"></div><div class="paginator"><a href="/2016/03/17/Java微信公众号应用部署在阿里云ECS/" class="next"><span>Next</span><i class="fa fa-chevron-right"></i></a></div></section><footer><section id="comments"><div data-thread-key="http://blog.zbvae.com/2016/04/10/使用Echarts制作散点图-Excel-导入数据方式/index.html" data-title="" data-url="http://blog.zbvae.com/2016/04/10/使用Echarts制作散点图-Excel-导入数据方式/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "zbbk" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section><div class="copyright"><p>© 2015 -  2016<span class="heart"><i class="icon-next-heart fa fa-heart"></i></span><a href="http://blog.zbvae.com">Bin Zhang</a></p></div></footer></div><label for="sidebar-toggle" class="sidebar-menu"><div class="menu"></div></label><label class="back2top"> <a href="#top"><div class="arrow"></div></a></label></body></html>